# 03_TCP和UDP协议剖析

TCP 协议：

- TCP 协议进行通信的两个应用进程：客户端、服务端。

- 使用 TCP 协议前，须先建立 TCP 连接，形成基于字节流的传输数据通道。
- 传输前，采用“三次握手”方式，点对点通信，是可靠的。
  - TCP 协议使用重发机制，当一个通信实体发送一个消息给另一个通信实体后，需要收到另一个通信实体确
    认信息，如果没有收到另一个通信实体确认信息，则会再次重复刚才发送的消息。
- 在连接中可进行大数据量的传输。
- 传输完毕，需释放已建立的连接，效率低。

UDP 协议：

- UDP 协议进行通信的两个应用进程：发送端、接收端。
- 将数据、源、目的封装成数据包 (传输的基本单位)，不需要建立连接发送不管对方是否准备好，接收方收到也不确认，不能保证数据的完整性，故是不可靠的。
- 每个数据报的大小限制在 64K 内。
- 发送数据结束时无需释放资源，开销小，通信效率高。
- 适用场景：音频、视频和普通数据的传输，例如视频会议。

三次握手：

TCP 协议中，在发送数据的准备阶段，客户端与服务器之间的三次交互，以保证连接的可靠。

- 第一次握手，客户端向服务器端发起 TCP 连接的请求。
- 第二次握手，服务器端发送针对客户端 TCP 连接请求的确认。
- 第三次握手，客户端发送确认的确认。

四次挥手：

TCP 协议中，在发送数据结束后，释放连接时需要经过四次挥手。

- 第一次挥手：客户端向服务器端提出结束连接，让服务器做最后的准备工作 。此时，客户端处于半关闭状态，即表示不再向服务器发送数据了，但是还可以接受数据。
- 第二次挥手：服务器接收到客户端释放连接的请求后，会将最后的数据发给客户端。并告知上层的应用进程不再接收数据。
- 第三次挥手：服务器发送完数据后，会给客户端发送一个释放连接的报文 。那么客户端接收后就知道可以正式释放连接了。
- 第四次挥手：客户端接收到服务器最后的释放连接报文后，要回复一个彻底断开的报文 。这样服务器收到后才会彻底释放连接。这里客户端，发送完最后的报文后，会等待 2MSL，因为有可能服务器没有收到最后的报文，那么服务器迟迟没收到，就会再次给客户端发送释放连接的报文，此时客户端在等待时间范围内接收到，会重新发送最后的报文，并重新计时。如果等待 2MSL 后，没有收到，那么彻底断开。